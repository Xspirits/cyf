<div id="sharePost"></div>
</div> <!-- End .canvas -->

    <!--  FOOTER -->
    <footer id="footer">
      <div class="container">
        <div class="row">
          <section class="col-md-12">
            <a href="https://plus.google.com/109925245483936264439" title="Follow us on Goolg+!" target="_blank" rel="publisher">Google+</a>
            | <a href="https://twitter.com/cyf_app" title="Follow us on Twitter!" target="_blank">Twitter</a>
            | <a href="https://www.facebook.com/cyfapp" title="Like us on Facebook!" target="_blank">Facebook</a>

            <a href="./about" class="pull-right" title="Like us on Facebook!">About</a>            
          </section>
        </div>        
      </div>
    </footer>
<!-- 
<canvas id="gotchaChallenge" class="hidden" width="100%" height="100%" style="overflow:hidden;margin:0;background: rgb(18,18,18); position:absolute; top:0; left:0;bottom:0;right:0; z-index:9999999;height: 110%; width:110%"></canvas> -->
<div id="fb-root"></div>

<script type="text/javascript">
(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.id=n;r.src="//connect.facebook.net/en_US/all.js#xfbml=1&appId=624902070914410";i.parentNode.insertBefore(r,i)})(document,"script","facebook-jssdk");(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="https://apis.google.com/js/platform.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();(function(){var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="https://apis.google.com/js/plusone.js?publisherid=109925245483936264439";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();!function(e,t,n){var r,i=e.getElementsByTagName(t)[0],s=/^http:/.test(e.location)?"http":"https";if(!e.getElementById(n)){r=e.createElement(t);r.id=n;r.src=s+"://platform.twitter.com/widgets.js";i.parentNode.insertBefore(r,i)}}(document,"script","twitter-wjs")(function(e,t,n,r,i,s,o){e["GoogleAnalyticsObject"]=i;e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date;s=t.createElement(n),o=t.getElementsByTagName(n)[0];s.async=1;s.src=r;o.parentNode.insertBefore(s,o)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-50004810-1","cyf-app.co");ga("send","pageview")</script>


</script>
<script src="/socket.io/socket.io.js"></script>

<script src="/js/init.js"></script>
<script type="text/javascript">
	$(function() {
    	moment().zone('+0200').format();

		var isMobile = ($(window).width() < 800) ? true : false;
		var url = window.location.href;
		var arr = url.split("/");
		var resultURL = arr[0] + "//" + arr[2];
		//Socket 
		//http://localhost:8080/leaderboard
		socket = io.connect(resultURL);
		// socket = io.connect('http://challenge-friends.herokuapp.com');

		socket.on('alive', function (data) {
			console.log('Challenger alive: '+data.date);
		});
		<% if (currentUser) { %>

			socket.on('globalevent', function (data) {

				console.log(data);
				pushStream(data);
			});
			<% } %>
			var pushStream = function(data) {
				var target = $('#streams')
				, template = '<li class="mepUp animated bounceInRight"><h5><i class="'+(data.icon ? data.icon : 'fa fa-circle-o') + '"></i> <span>'+data.message+'</span></h5><p class="text-right"><small>'+(data.desc?data.desc:'')+'</small></p> <span class="dateFrom"><span class="timeFromUp" data-date="'+data.date+'">1 second</span> ago</span></li>';

				target.prepend(template);

			}

		// nprogress Is disabled for now, could be using it in the future though.
		var myLevel = Math.round((<%= currentUser.xp/ (currentUser.xp + currentUser.xpNext) %>)*100)/100;
		var flatten = Math.round((myLevel * .8)*100);
		$('#user-xpbar').width(flatten + '%')
		
		// NProgress.configure({ ease: 'ease-in-out', speed: 2239, showSpinner: false  });
		// NProgress.set( myLevel );

		// NOTIFICATIONS =========================
		alertify.set({ delay : 12000 });
		var queue = [];
		var hasCSuccess = [];

		<% if (currentUser) {

			if(currentUser.notifications && currentUser.notifications.length > 0) { 

				var notif = currentUser.notifications
				, limit = 9;

				for (var i = notif.length - 1; i >= 0; i--) {
					if(notif[i].isSeen == false) { 
						--limit;

						if(notif[i].type == 'challengeSuccess' && !isMobile){ %>
							var obj_<%= i %> = {
								title : '<%= notif[i].to %>',
								link : '<%= notif[i].link2 %>',
								message : '<%= notif[i].title %>'
							}
							hasCSuccess.push(obj_<%= i %>);
							<%
						} %>

						queue.push(['<i class="<%= notif[i].icon %>"></i> <a href="<%= notif[i].link1 %>" title="<%= notif[i].title %>"><strong><%= notif[i].title %></strong></a> <a href="<%= notif[i].link2 %>" ><%= notif[i].to %></a> <%= notif[i].message %>','<%= notif[i]._id %>', <%= notif[i].persist ? false : true %>, true]);
						// <%= (notif[i].persist && currentUser.allowDeskNotif) ? true : false %>
						console.log(<%= i %> + ' ' + <%= limit %> + ' max ' + <%= notif.length %>+ ' queue ' + queue.length);
						<% 
					} 
				}
			}
		} %>

		notif(queue, queue.length -1); 
		// challengeAlert(); 
		readability();
		readabilityAgo();

		setTimeout(function(){
			$('.odometer').each(function(){
				var number = Math.floor(parseInt($(this).attr('data-number')));

				$(this).html(number);
			});
		}, 1000);

			// Progress animation
			(function animateProgress() {
				$('.tinyProgress').each(function(){
					var w   = $(this).attr('data-percent') - 2;
					$(this).width(w + '%');
				});	
			})();
				
			function notif (queue,i) {     

				setTimeout(function () {  
					if(queue[i]) {
						sendNotif(queue[i][0],queue[i][1],queue[i][2])
						if (--i) notif(queue, i);  
					}    			
				}, 220)
			} 
			$('.righty').hover(function(){
				if(!$('.liveFeed').hasClass('sticked'))
					$('.liveFeed').addClass('active');
			},function(){
				if(!$('.liveFeed').hasClass('sticked'))
					$('.liveFeed').removeClass('active');
			});
			$('.righty').on('click', function(){
				$('.liveFeed').toggleClass('sticked');
			})
			$('#dismissBoxChall').click(function(e){
				e.preventDefault();
				$('#gotchaChallenge,#gotaBoxContent')
				.removeClass('flipInX')
				.addClass('flipOutX');

				$('#gotchaChallenge').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){

					$('#gotchaChallenge,#gotaBoxContent')
					.remove();
				});
			})
			function challengeAlert (){
				var number = hasCSuccess.length;

				if(number >= 1 ){

					var template = '<div id="gotaBoxContent" class="animated" style="margin: 0; position: relative;z-index:99999991;height: 100%; width:100%;display: block;top: 50%;padding: 50px 0;"><div style="width: 50%; height: 50%; overflow: auto; margin: auto; position: relative;"><h1 style="color: white">Congratulation!</h1><p><hr><h3 style="color: rgb(255, 248, 81)">'+hasCSuccess[0].message+'</h3></p><hr><p><a href="#" id="dismissBoxChall" title="dissmiss this!">Dissmiss</a></p></div></div>';
					$("#gotchaChallenge").html(template);
    				// popChallengeSuccessbox();

    				$('#gotchaChallenge').fadeIn('slow').removeClass('hidden');


    			}
    		}
			// Launch some fun timers
			timeFromUp();
			setInterval(function(){
				timeFromUp();
			},60000);
		});
var sendNotif= function(msg, idNotif, del) {

	alertify.log(msg, 'info');

	var target = {					
		del : del,
		id : idNotif
	}
	$.ajax({
		type: 'POST',
		data: JSON.stringify(target),
		contentType: 'application/json',
		url: './markNotifRead',						
		success: function(data) {
			console.log(data);
		}
	});				
}
var timeFromUp = function(){
	$('.timeFromUp').each( function () {
		var start = $(this).attr('data-date');
		var converted = moment(start).countdown().toString();
		$(this).text(converted);
	})
}
</script>